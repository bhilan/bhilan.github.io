<!doctype html>
<html class="no-js" lang="">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>A Complete Guide to Email in Emacs using Mu and Mu4e</title>
    <meta name="description" content="Most email clients are a pain. Emacs &amp; mu4e are less of a pain.">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    

<link rel="apple-touch-icon" sizes="57x57" href="/static/c2c_icons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/static/c2c_icons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/static/c2c_icons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/static/c2c_icons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/static/c2c_icons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/static/c2c_icons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/static/c2c_icons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/static/c2c_icons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/static/c2c_icons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="/static/c2c_icons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/static/c2c_icons/favicon-194x194.png" sizes="194x194">
<link rel="icon" type="image/png" href="/static/c2c_icons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/static/c2c_icons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/static/c2c_icons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/static/c2c_icons/manifest.json">
<link rel="mask-icon" href="/static/c2c_icons/safari-pinned-tab.svg" color="#773333">
<link rel="shortcut icon" href="/static/c2c_icons/favicon.ico">
<meta name="msapplication-TileColor" content="#773333">
<meta name="msapplication-TileImage" content="/static/c2c_icons/mstile-144x144.png">
<meta name="msapplication-config" content="/static/c2c_icons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

    <!-- 3rd March 2022 07:41 -->
    <!-- Fonts -->    
    <link href='https://fonts.googleapis.com/css?family=Unica+One' rel='stylesheet' type='text/css'>
    <script src="https://use.typekit.net/qeu2zlf.js"></script>
    <script>try{Typekit.load({ async: false });}catch(e){}</script>
    <noscript>
      <!-- Fallback fonts (if no JS) -->
      <link href='http://fonts.googleapis.com/css?family=Dosis:400|Anonymous+Pro' rel='stylesheet' type='text/css'>
    </noscript>

    <!-- Styles / Scripts -->
    
    <link rel="stylesheet" href="/static/styles/css/cachestocaches.min.css"/>
    <script src="/static/styles/js/modernizr-2.8.3.min.js"></script>

    

  
  
  
  <meta name="twitter:card"
          content="summary_large_image" />
  <meta prefix="og: http://ogp.me/ns#"
          name="twitter:title"
          property="og:title"
          content="A Complete Guide to Email in Emacs using Mu and Mu4e" />
  <meta name="twitter:site"
          content="@CachesToCaches">
  <meta prefix="og: http://ogp.me/ns#"
          property="og:type"
          content="website" />
  
  
    <meta prefix="og: http://ogp.me/ns#"
            name="twitter:image:src"
            property="og:image"
            content="http://cachestocaches.com/media/photologue/photos/cache/email_in_emacs_display.jpg" />
    <meta name="thumbnail"
            content="http://cachestocaches.com/media/photologue/photos/cache/email_in_emacs_thumbnail.jpg" />
  
  
  <meta prefix="og: http://ogp.me/ns#"
          name="twitter:description"
          property="og:description"
          content="Most email clients are a pain. Emacs &amp; mu4e are less of a pain." />
  <meta prefix="og: http://ogp.me/ns#"
          property="og:url"
          content="http://cachestocaches.com/2017/3/complete-guide-email-emacs-using-mu-and-/" />

  </head>

  <body
      itemscope
      itemtype="http://schema.org/WebPage"
      data-spy="scroll"
      data-target="#side-nav">
    
    <nav class="sidebar">
      <div class="content">
        
  <div><a href="/"><img src="/static/logos/c2c_logo_2.png" class="img-responsive center-block" style="width:240px;"/></a></div>
  <br/>
  <div class="center-text narrow-font">
    <span><a href="/">home</a></span>
    <span class="center-dot"></span>
    <span><a href="/archive/">archive</a></span>
    <span class="center-dot"></span>
    <span><a href="/contributors/">about</a></span>
  </div>
  <div class="social-icon-container">
    <a class="social-icon light-border twitter" href="https://twitter.com/intent/follow?screen_name=CachesToCaches"></a>
    <a class="social-icon light-border facebook" href="https://www.facebook.com/CachesToCaches"></a>
    <a class="social-icon light-border googleplus" href="https://www.google.com/+Cachestocaches_c2c" rel="publisher"></a>
    <a class="social-icon light-border github" href="https://github.com/CachesToCaches"></a>
    <a class="social-icon light-border rss-feed" href="/feed"></a>
  </div>

  <img class="bottom-art" src="/static/art/c2c_triangles.svg"></img>
  <div class="center-text floating-description"><a href="http://gjstein.com">designed and maintained by<br/>Gregory J Stein</a></div>

        <br/>
        
  <div class="title"><a href="#">A Complete Guide to Email in Emacs using Mu and Mu4e</a></div>
  <hr/>
  <div id="nav-sidebar">
    <ul class="nav" id="toc"></ul>
  </div>
  <hr/>
  
    <br/>
    <div class="title">
      <div><small>part 4 of</small></div>
      <a href="/series/emacs-productivity/" class="nav-title">Emacs For Productivity</a>
    </div>
    <hr/>
    <div class="description">A collection of tips and guides for using Emacs to master your life.</div>
    <hr/>
  

      </div>
    </nav>
    <nav class="header">
      
  <div class="content">
  <span class="heading-font"><a href="/">Caches to Caches</a> | </span><span><a href="/">home</a></span><span class="center-dot"></span><span><a href="/archive/">archive</a></span><span class="center-dot"></span><span><a href="/contributors/">about</a></span>
  </div>

    </nav>
    <div class="page"
         itemsope
         itemtype="http://schema.org/Blog">
      <div class="content-top">
        
  <div class="unit-line-height">
  
  <!-- Series Details -->

  <!-- Post Image -->
    <div class="marginnote invisible-sm post-detail">
      <div>
      
        <p><div class="unit-line-height"><small class="heading-font">
          Part 4 of
        </small></div>
        <div><a class="series heading-font" href="/series/emacs-productivity/">Emacs For Productivity</a></div>
        </p>
      

        <p><div class="date heading-font">Thu 2 Mar 2017</div>
          <a href="/contributors/#gregory-j-stein"><span class="author" itemprop="name">Gregory J Stein</span></a>
          
        </p>

        
          <p><div class="heading-font">Category</div>
            <a class="category" href="/category/general-computing/">
              General Computing
            </a>
          </p>
        

        
          <p><div class="heading-font">Tags</div>
            
              <a class="tag" href="/tag/emacs/">Emacs</a>
            
              <a class="tag" href="/tag/productivity/">Productivity</a>
            
          </p>
        
      </div>
    </div>

    
      <h1 class="title">
        <div>
          <span itemprop="name">A Complete Guide to Email in Emacs using Mu and Mu4e</span>
        </div>
      </h1>
    

    


    <div class="note visible-sm post-detail">
      <div>

      <div>
        <span class="date heading-font">Thu 2 Mar 2017</span>
          <a href="/contributors/#gregory-j-stein"><span class="author" itemprop="name">Gregory J Stein</span></a>
          
      </div>

        
          <div>
          <span class="heading-font">Category</span>
            <a class="category" href="/category/general-computing/">
              General Computing
            </a>
          </div>
        

        
          <div><span class="heading-font">Tags</span>
            
              <a class="tag" href="/tag/emacs/">Emacs</a>
            
              <a class="tag" href="/tag/productivity/">Productivity</a>
            
          </div>
        


        
        <div style="height: 10px"></div>
            <div><span class="unit-line-height"><span class="heading-font">
              Part 4 of
            </span></span>
            <span><a class="series heading-font" href="/series/emacs-productivity/">Emacs For Productivity</a></span>
            </div>
          
      </div>
    </div>


</div>


      </div>
      <div class="content">
        
  
  <div class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">

  <!-- Post Title -->
  
  

  <!-- Post Content -->
  
    <div class="justify word-break" itemprop="articleBody">
      
        <p>I get a lot of email. I'm also pretty sure you get a lot of email. However, email is still not a solved problem<span class="sidenote note no-word-break invisible-sm">This is evidenced by the fact that a quick Google search yields no less than ten viable options for email clients on my Mac. </span>. Each potential email client is acceptable on it's own, yet none of them satisfied all of my desired features:
<p class="note no-word-break visible-sm">This is evidenced by the fact that a quick Google search yields no less than ten viable options for email clients on my Mac. </p></p>
<ul>
<li>The ability to access my email without an internet connection<span class="sidenote note no-word-break invisible-sm">I travel quite a lot, so this was very important to me. </span>.</li>
<p class="note no-word-break visible-sm">I travel quite a lot, so this was very important to me. </p>
<li>Easily move messages between different folders, which is how I keep all of my emails organized by project.</li>
<li>Quick yet powerful search of all my mail messages.</li>
<li>Having an auto-updating status indicator that shows me how many unread messages I have.</li>
<li>Managing multiple accounts (Gmail for personal emails and Microsoft Exchange for work emails) and syncing local changes so that my phone can still be up-to-date.</li>
</ul>

<p>If you follow this blog, you'll recognize that I've gotten a bit carried away with migrating the different aspects of my life to operate within the Emacs environment. So it was only a matter of time until I finally decided to give it a shot, and I converged upon a solution which happily satisfies all of the above constraints. Every email service is a bit different so YMMV, but this setup works for me.</p>
<p></p>
<p>Here's a screenshot of what we'll be setting up:</p>
<p><div class="out-img-wrapper"><div><note class="marginnote img-caption invisible-sm"><p>A screenshot of the mu4e interface after searching for recent emails from Amazon. Notice that I've "marked" a number of messages for deletion <code>d</code>, archiving <code>r</code>, and moving <code>m</code>. I also have an icon at the bottom right corner that shows I have 17 unread messages.</p></note><img src="/media/photologue/photos/cache/Screen_Shot_2017-03-01_at_8.55.28_AM_display.png" class="img-responsive center-block" title="A screenshot of a mu4e view" style="max-height:393px"/><note class="img-caption visible-sm"><p>A screenshot of the mu4e interface after searching for recent emails from Amazon. Notice that I've "marked" a number of messages for deletion <code>d</code>, archiving <code>r</code>, and moving <code>m</code>. I also have an icon at the bottom right corner that shows I have 17 unread messages.</p></note></div></div></p>
<h2>My brief adventure with Gnus</h2>
<p>There are a ton of tutorials available for reading one's email with Gnus, so it was a natural starting point for my quest. After setting it up, Gnus starts into the standard <em>group summary list</em>, which will display all of the folders it discovered in your various mail accounts. To me, this seemed a bit much, since I have a ton of folders, but this alone wasn't enough to deter me. Unfortunately, I also found that it was quite slow<span class="sidenote note no-word-break invisible-sm">In fact, the slowness of Gnus is rather <a href="https://www.emacswiki.org/emacs/GnusSpeed">well documented</a> on the Emacs Wiki </span> and that the interface was rather cumbersome. The suggested solution to this problem is to host a local email server (<em>groan</em>), which syncs with the Gmail and your other email accounts.
<p class="note no-word-break visible-sm">In fact, the slowness of Gnus is rather <a href="https://www.emacswiki.org/emacs/GnusSpeed">well documented</a> on the Emacs Wiki </p></p>
<p>In order to get Gnus working properly, <a href="http://sachachua.com/blog/2008/05/geek-how-to-use-offlineimap-and-the-dovecot-mail-server-to-read-your-gmail-in-emacs-efficiently/">Sacha Chua</a> recommends installing two tools: <code>offlineimap</code> for the email synchronization and <code>dovecot</code> for hosting a local IMAP server, since that's how Gnus is able to read the messages. I was able to get <code>offlineimap</code> working relatively quickly (more on that later), and before too long I had a local copy of all my emails since the dawn of time. By contrast, <code>dovecot</code> had me scratching my head. Not only could I not get it to work, but it seemed like an unnecessary amount of complexity; I was hosting a local webserver so that my Emacs mail client could read emails that were already saved to my system. So it was at this point that I moved on in search of a better way.</p>
<h2>An introduction to mu</h2>
<p>After a bit of searching around, I came across a fantastic tool called <a href="http://www.djcbsoftware.nl/code/mu/">mu</a>. At it's core, mu is a simple command line tool for searching through emails<span class="sidenote note no-word-break invisible-sm">See the <a href="http://www.djcbsoftware.nl/code/mu/cheatsheet.html">mu "cheatsheet"</a> for examples of more powerful search features within mu. </span>. Simply type <code>mu find $SEARCH</code> into the terminal to query your emails.
<p class="note no-word-break visible-sm">See the <a href="http://www.djcbsoftware.nl/code/mu/cheatsheet.html">mu "cheatsheet"</a> for examples of more powerful search features within mu. </p></p>
<p>It's a cute little tool, and is especially nice for allowing you to quickly check for any new email<span class="sidenote note no-word-break invisible-sm">You can easily search for unread emails with <code>flag:unread</code>. </span> without leaving the terminal. Yet this still doesn't solve all my problems; sure I have an offline copy of my messages and I can search them with ease, but how do I read them, move them around, or interact with them in other ways?
<p class="note no-word-break visible-sm">You can easily search for unread emails with <code>flag:unread</code>. </p></p>
<p>This is where mu4e comes in, the Emacs email client included with mu. It's this that provides me with all of the functionality that I desire: being able to search an offline copy of my emails, easily move them around, and send/reply to different mail servers.</p>
<p>In addition, mu4e has the ability to auto-complete email addresses from names, follow rules about where to archive mail that matches certain filters (like keywords in the subject line) and, via an Emacs package, display a status icon in the modeline when I have new mail messages. In the next few sections, I'll describe how I got everything to work, and any pitfalls I encountered along the way.</p>
<h2>Getting set up with mu and OfflineIMAP</h2>
<p>As advertised, mu is really just for indexing and searching emails, and relies on other software to maintain a local copy of your messages, which it can then use. To do this, I chose to use the popular <a href="http://www.offlineimap.org">OfflineIMAP</a><span class="sidenote note no-word-break invisible-sm">On macOS, I installed this with <code>brew install offlineimap</code>; on Ubuntu, this can be done with apt. </span>, since it's relatively easy to get setup. I have my OfflineIMAP manage two different accounts, Gmail and Exchange, and sync changes between the online services every 5 minutes. Rather than ramble on about how everything should be set up, I'll just reproduce some of the important parts of my configuration file here (taken from my <code>~/.offlineimaprc</code>):
<p class="note no-word-break visible-sm">On macOS, I installed this with <code>brew install offlineimap</code>; on Ubuntu, this can be done with apt. </p></p>
<p><div class="listing-caption visible-sm">And example OfflineIMAP configuration <code class="code-language">python</code></div><div class="sidenote listing-caption invisible-sm"><div>And example OfflineIMAP configuration</div><div class="unit-line-height"><code class="code-language">python</code></div></div><pre><code class="lang-python pre-scrollable">[general]
accounts = Gmail, Exchange
maxsyncaccounts = 2

[Account Gmail]
localrepository = LocalGmail
remoterepository = RepositoryGmail
autorefresh = 5
quick = 10
postsynchook = mu index --maildir ~/Maildir
status_backend = sqlite

[Reposiroty LocalGmail]
type = Maildir
localfolders = ~/Maildir/Gmail

[Reposiroty RepositoryGmail]
type = Gmail
maxconnections = 2
remoteuser = YOUR_GMAIL_USERNAME
remotepass = YOUR_GMAIL_PASSWORD
folderfilter = lambda foldername: foldername not in ['[Gmail]/All Mail', '[Gmail]/Important']
sslcacertfile = /usr/local/etc/openssl/cert.pem  # This will only work for macOS

## Try one of the following for Ubuntu or Arch:
# sslcacertfile = /etc/ssl/certs/ca-certificates.crt
# sslcacertfile = OS-DEFAULT

# These are effectively the same as the above
[Account Exchange]
[Repository LocalExchange]
[Repository RemoteExchange]
</code></pre></p>
<p>You'll notice a few things about this configuration<span class="sidenote note no-word-break invisible-sm">You may also notice that arbitrary python code can be specified as part of the configuration. </span>. First, as I have it listed above, you have to enter your password directly into this file, which you probably don't want to do; there's a great <a href="http://unix.stackexchange.com/a/48355">Stack Exchange post</a> on how to use GPG and python to encrypt your password. Second, I have included a <code>folderfilter</code> to avoid storing the <em>All Mail</em> and <em>Important</em> folders that Gmail annoyingly creates. Finally, I call <code>mu index</code> whenever the sync is complete, via <code>postsynchook</code>, to ensure that my mu database is as up-to-date as much as possible<span class="sidenote note no-word-break invisible-sm">By default, mu looks to <code>~/Maildir</code> for mail, but I like to include it for clarity. </span>.
<p class="note no-word-break visible-sm">You may also notice that arbitrary python code can be specified as part of the configuration. </p><p class="note no-word-break visible-sm">By default, mu looks to <code>~/Maildir</code> for mail, but I like to include it for clarity. </p></p>
<p>Once this is setup, calling <code>offlineimap</code> from the command line will sync with the remote repositories every 5 minutes. However, this requires keeping the terminal window open. This can be solved by creating a daemon process. On macOS, this is built in to brew, and calling <code>brew services start offlineimap</code> will get everything started; for Linux, you can follow these <a href="https://wiki.archlinux.org/index.php/OfflineIMAP#Running_offlineimap_in_the_background">instructions on the Arch Linux wiki</a>.</p>
<p>With this step complete, the command line version of mu should now be syncing with the remote server(s) without any issues.</p>
<h2>Configuring mu4e</h2>
<p>Before even getting to the Emacs configuration file, you should ensure that mu4e is properly installed. Since mu4e is included with the installation of mu<span class="sidenote note no-word-break invisible-sm">On macOS, this is only partially true. See <a href="http://blog.danielgempesaw.com/post/43467552978/installing-mu-and-mu4e-with-homebrew-with-emacs">to insure that the install includes mu4e</a>. </span> you need to include mu4e. This can be done with something like <code>(add-to-list 'load-path "/usr/local/share/emacs/site-lisp/mu/mu4e")</code>. Now, upon reopening Emacs, <code>M-x mu4e</code> should open a simple window with some shortcuts. Typing <code>J</code> will bring up a menu for selecting a mail folder. Chose one, and you should be presented with something resembling the screenshot above.
<p class="note no-word-break visible-sm">On macOS, this is only partially true. See <a href="http://blog.danielgempesaw.com/post/43467552978/installing-mu-and-mu4e-with-homebrew-with-emacs">to insure that the install includes mu4e</a>. </p></p>
<p>When in the <em>headers view</em>, which displays your email messages, you can easily navigate through different messages using <code>n</code> and <code>p</code> and hitting <code>return</code> will open a message, allowing you to read it. In addition, mu4e includes some very useful marking capabilities: <code>d</code> marks a message for deletion, <code>r</code> for refiling/archiving, and <code>m</code> for moving (after a target directory is specified). Simply press <code>x</code> to "execute" the marks. In addition, with <code>*</code> you can "bulk mark" emails; pressing <code>x</code> after some messages have been marked with <code>x</code> will allow you to perform an action to all of them. See the <a href="https://www.djcbsoftware.nl/code/mu/mu4e/Keybindings.html">mu4e user manual</a> for more details.</p>
<p>I mentioned above that I have two different email addresses and rely on mu4e to manage them both. In the previous screenshot, you can see that I've marked messages for archiving with <code>r</code> and deletion<span class="sidenote note no-word-break invisible-sm">See the section below for a caveat about deletion, to avoid premeturely deleting your messages! </span> with <code>d</code> yet the behavior for the different messages changes depending on their <em>mu4e context</em>. By setting the <code>mu4e-contexts</code> variable, mu4e will search through the list of options, see if the message of interest matches <code>:match-func</code> and sets some local variables, like the <code>mu4e-refile-folder</code>. In the snippet below, I check to see if the mail directory (<code>:maildir</code>) includes <code>/Gmail</code> and, if it does, sets the trash and refile folders accordingly.
<p class="note no-word-break visible-sm">See the section below for a caveat about deletion, to avoid premeturely deleting your messages! </p></p>
<p><div class="listing-caption visible-sm">Defining mu4e contexts <code class="code-language">lisp</code></div><div class="sidenote listing-caption invisible-sm"><div>Defining mu4e contexts</div><div class="unit-line-height"><code class="code-language">lisp</code></div></div><pre><code class="lang-lisp pre-scrollable">(setq mu4e-contexts
 `( ,(make-mu4e-context
     :name "Gmail"
     :match-func (lambda (msg) (when msg
       (string-prefix-p "/Gmail" (mu4e-message-field msg :maildir))))
     :vars '(
       (mu4e-trash-folder . "/Gmail/[Gmail].Trash")
       (mu4e-refile-folder . "/Gmail/[Gmail].Archive")
       ))
   ,(make-mu4e-context
     :name "Exchange"
     :match-func (lambda (msg) (when msg
       (string-prefix-p "/Exchange" (mu4e-message-field msg :maildir))))
     :vars '(
       (mu4e-trash-folder . "/Exchange/Deleted Items")
       (mu4e-refile-folder . exchange-mu4e-refile-folder)
       ))
   ))
</code></pre></p>
<p>For my Exchange server, I have a slightly more complicated procedure; rather than including a specific refile folder, I define a function <code>exchange-mu4e-refile-folder</code> which does some more filtering. Apparently I don't want any emails from this fictitious going to the typical archive folder. So, whenever I get a message which includes "[some-mailing-list]" in the subject, I can still refile the message with <code>r</code> and know that it will go to the correct folder.</p>
<p><div class="listing-caption visible-sm">A custom refiling function <code class="code-language">lisp</code></div><div class="sidenote listing-caption invisible-sm"><div>A custom refiling function</div><div class="unit-line-height"><code class="code-language">lisp</code></div></div><pre><code class="lang-lisp pre-scrollable">(defun exchange-mu4e-refile-folder (msg)
  "Function for chosing the refile folder for my Exchange email.
   MSG is a message p-list from mu4e."
  (cond
   ;; FLA messages
   ((string-match "\\[some-mailing-list\\]"
          (mu4e-message-field msg :subject))
    "/Exchange/mailing-list")
   (t "/Exchange/Archive")
   )
  )
</code></pre></p>
<h2>Alerts for new mail</h2>
<p>Now that we can receive email, move it around and keep everything in sync with our different IMAP servers, the next task is to ensure that we're alerted whenever new mail arrives. Fortunately, there's another Emacs package for doing just this: <a href="https://github.com/iqbalansari/mu4e-alert">mu4e-alert</a>. The procedure for using mu4e-alert is relatively simple. Whenever you call <code>mu4e-alert-enable-mode-line-display</code>, your modeline will be updated to include a little envelope icon and the current count of unread messages<span class="sidenote note no-word-break invisible-sm">The format of the modeline display can be changed by customizing <code>mu4e-alert-modeline-formatter</code>. </span>.
<p class="note no-word-break visible-sm">The format of the modeline display can be changed by customizing <code>mu4e-alert-modeline-formatter</code>. </p></p>
<p>You're expectedly a bit annoyed, thinking <em>I thought the icon would update itself!</em> Fortunately, Emacs has the <code>run-with-timer</code> for just this purpose. However, there remains a small issue: whenever mu4e is open, it maintains a connection to the server. This means that <code>mu index</code> cannot be run by the OfflineIMAP process whenever mu4e is left open, and new mail will not appear. This is far from ideal. Again, I have a <em>slightly hacky</em> solution. By calling <code>mu4e~proc-kill</code> periodically, we can sever mu4e's connection to the server. The only consequence of this is that I may occasionally try to archive messages in my inbox that I've already moved on my phone, an issue which is easily remedied by refreshing my mu4e buffer.</p>
<p>My complete mu4e-alert configuration, which relies on John Wiegley's <a href="https://github.com/jwiegley/use-package">use-package</a>, is as follows:</p>
<p><div class="listing-caption visible-sm">Mu4e-alert configuration <code class="code-language">lisp</code></div><div class="sidenote listing-caption invisible-sm"><div>Mu4e-alert configuration</div><div class="unit-line-height"><code class="code-language">lisp</code></div></div><pre><code class="lang-lisp pre-scrollable">(use-package mu4e-alert
  :ensure t
  :after mu4e
  :init
  (setq mu4e-alert-interesting-mail-query
    (concat
     "flag:unread maildir:/Exchange/INBOX "
     "OR "
     "flag:unread maildir:/Gmail/INBOX"
     ))
  (mu4e-alert-enable-mode-line-display)
  (defun gjstein-refresh-mu4e-alert-mode-line ()
    (interactive)
    (mu4e~proc-kill)
    (mu4e-alert-enable-mode-line-display)
    )
  (run-with-timer 0 60 'gjstein-refresh-mu4e-alert-mode-line)
  )
</code></pre></p>
<p>There's one other hiccup that I haven't yet mentioned; some email servers (<em>cough Gmail cough</em>) will mark messages as unread whenever they are moved to other folders, including the trash. As a result, I've customized my <code>mu4e-alert-interesting-mail-query</code> variable to check for unread messages in only my inbox folders.</p>
<h2>Using mu4e to send mail</h2>
<p>Unfortunately IMAP, the protocol for checking email and moving them around, cannot be used to send emails: for that you need to configure SMTP. This process isn't particularly difficult, but it does include a bunch of code, most of which is adapted from <a href="https://www.djcbsoftware.nl/code/mu/mu4e/Multiple-accounts.html">the mu4e documentation</a><span class="sidenote note no-word-break invisible-sm">If you only have a single account, most of this is unnecessary. </span>. After setting the default values for many of the SMTP parameters, we create a list of account-specific parameter values which are loaded upon composing a message by the <code>my-mu4e-set-account</code> function. I've included most of my configuration here for the sake of completeness.
<p class="note no-word-break visible-sm">If you only have a single account, most of this is unnecessary. </p></p>
<p><div class="listing-caption visible-sm">Configuration for sending mail <code class="code-language">lisp</code></div><div class="sidenote listing-caption invisible-sm"><div>Configuration for sending mail</div><div class="unit-line-height"><code class="code-language">lisp</code></div></div><pre><code class="lang-lisp pre-scrollable">;; I have my "default" parameters from Gmail
(setq mu4e-sent-folder "/Users/Greg/Maildir/sent"
      ;; mu4e-sent-messages-behavior 'delete ;; Unsure how this should be configured
      mu4e-drafts-folder "/Users/Greg/Maildir/drafts"
      user-mail-address "gregory.j.stein@gmail.com"
      smtpmail-default-smtp-server "smtp.gmail.com"
      smtpmail-smtp-server "smtp.gmail.com"
      smtpmail-smtp-service 587)

;; Now I set a list of 
(defvar my-mu4e-account-alist
  '(("Gmail"
     (mu4e-sent-folder "/Gmail/sent")
     (user-mail-address "YOUR.GMAIL.USERNAME@gmail.com")
     (smtpmail-smtp-user "YOUR.GMAIL.USERNAME")
     (smtpmail-local-domain "gmail.com")
     (smtpmail-default-smtp-server "smtp.gmail.com")
     (smtpmail-smtp-server "smtp.gmail.com")
     (smtpmail-smtp-service 587)
     )
     ;; Include any other accounts here ...
    ))

(defun my-mu4e-set-account ()
  "Set the account for composing a message.
   This function is taken from: 
     https://www.djcbsoftware.nl/code/mu/mu4e/Multiple-accounts.html"
  (let* ((account
    (if mu4e-compose-parent-message
        (let ((maildir (mu4e-message-field mu4e-compose-parent-message :maildir)))
    (string-match "/\\(.*?\\)/" maildir)
    (match-string 1 maildir))
      (completing-read (format "Compose with account: (%s) "
             (mapconcat #'(lambda (var) (car var))
            my-mu4e-account-alist "/"))
           (mapcar #'(lambda (var) (car var)) my-mu4e-account-alist)
           nil t nil nil (caar my-mu4e-account-alist))))
   (account-vars (cdr (assoc account my-mu4e-account-alist))))
    (if account-vars
  (mapc #'(lambda (var)
      (set (car var) (cadr var)))
        account-vars)
      (error "No email account found"))))
(add-hook 'mu4e-compose-pre-hook 'my-mu4e-set-account)
</code></pre></p>
<h2>Pitfalls and additional tweaks</h2>
<p>I already touched upon a few of the minor issues I encountered when getting everything here to work properly, including how moved messages will occasionally be marked as unread. The biggest <em>uh oh</em> I had to deal with stemmed from some <a href="https://github.com/OfflineIMAP/offlineimap/issues/142">unexptected behavior</a> with OfflineIMAP. Apparently, whenever a message is marked with the trash label <code>T</code>, which happens whenever you 'delete' a message with <code>d</code>, OfflineIMAP won't sync it back to the server and, worse still, may delete it entirely. Even though I've marked an item for deletion, I'm comforted by the fact that I can recover a message if I accidentally move it to the trash.</p>
<p>Avoiding this issue requires modifying the way the delete mark <code>d</code> operates. I simply replaced <code>+T-N</code> with <code>-N</code> in the definition of the trash mark. It was a simple (if rather verbose) fix, so I've included it here in its entirety.</p>
<p><div class="listing-caption visible-sm">Avoid trashing when deleting <code class="code-language">lisp</code></div><div class="sidenote listing-caption invisible-sm"><div>Avoid trashing when deleting</div><div class="unit-line-height"><code class="code-language">lisp</code></div></div><pre><code class="lang-lisp pre-scrollable">(defun remove-nth-element (nth list)
  (if (zerop nth) (cdr list)
    (let ((last (nthcdr (1- nth) list)))
      (setcdr last (cddr last))
      list)))
(setq mu4e-marks (remove-nth-element 5 mu4e-marks))
(add-to-list 'mu4e-marks
     '(trash
       :char ("d" . "▼")
       :prompt "dtrash"
       :dyn-target (lambda (target msg) (mu4e-get-trash-folder msg))
       :action (lambda (docid msg target) 
                 (mu4e~proc-move docid
                    (mu4e~mark-check-target target) "-N"))))
</code></pre></p>
<p>Finally, here are a few more tweaks to the mu4e settings that I frequently use.</p>
<p><div class="listing-caption visible-sm">Other tweaks <code class="code-language">lisp</code></div><div class="sidenote listing-caption invisible-sm"><div>Other tweaks</div><div class="unit-line-height"><code class="code-language">lisp</code></div></div><pre><code class="lang-lisp pre-scrollable">;; Include a bookmark to open all of my inboxes
(add-to-list 'mu4e-bookmarks
       (make-mu4e-bookmark
        :name "All Inboxes"
        :query "maildir:/Exchange/INBOX OR maildir:/Gmail/INBOX"
        :key ?i))

;; This allows me to use 'helm' to select mailboxes
(setq mu4e-completing-read-function 'completing-read)
;; Why would I want to leave my message open after I've sent it?
(setq message-kill-buffer-on-exit t)
;; Don't ask for a 'context' upon opening mu4e
(setq mu4e-context-policy 'pick-first)
;; Don't ask to quit... why is this the default?
(setq mu4e-confirm-quit nil)
</code></pre></p>
<h2>Wrapping Up</h2>
<p>I'll try to keep this document up-to-date as I experiment more, however I'm already quite happy with my setup after a couple of weeks of trying it out. There are plenty of features that I haven't touched upon as well, including the ability to link to email messages via org-mode, in which I <a href="http://www.cachestocaches.com/2016/9/my-workflow-org-agenda/">do much of my work</a>. At any rate, it's just another excuse for me to never leave my Emacs environment.</p>
      
    </div>
  

  <!-- Post Footer -->
  

  <!-- Additional Metadata -->
  <meta itemprop="description" content="Most email clients are a pain. Emacs &amp; mu4e are less of a pain.">

</div>


      </div>
      <div class="content-bottom">
        

  <hr/>
  <p><blockquote>
    Liked this post? Subscribe to our <a class="post-link" href="/feed">RSS feed</a> or add your email to our newsletter:

    <!-- Begin MailChimp Signup Form -->
    <link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
    <div id="mc_embed_signup">
      <form action="https://cachestocaches.us15.list-manage.com/subscribe/post?u=f290745e370ad37f53ed7c7ac&amp;id=b7922d14de" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
        <div id="mc_embed_signup_scroll">
	  
	  <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
          <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
          <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_f290745e370ad37f53ed7c7ac_b7922d14de" tabindex="-1" value=""></div>
          <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
        </div>
      </form>
    </div>

  </blockquote></p>

  <!--End mc_embed_signup-->
  <hr/>


  <!-- All posts in series -->
  
    <div class="post-list">
      <div class="heading-font">all posts in series</div>
      <h3><a href="/series/emacs-productivity/" class="nav-title">Emacs For Productivity</a></h3>
      <div class="small-line-height">A collection of tips and guides for using Emacs to master your life.</div>
      <ul class="small-post-list">
        
          <li ><a class="small-title" href="/2015/8/getting-started-use-package/">1 <span class="center-dot"></span> Getting Started with Use-Package</a>
            <div class="small-detail">Jump-start emacs with use-package and never manually install another package again</div></li>
        
          <li ><a class="small-title" href="/2016/9/my-workflow-org-agenda/">2 <span class="center-dot"></span> My Workflow with Org-Agenda</a>
            <div class="small-detail">I use Emacs&#x27; &quot;org-mode&quot; to organize my life. Here&#x27;s a snippet of how I get it all working.</div></li>
        
          <li ><a class="small-title" href="/2016/12/vim-within-emacs-anecdotal-guide/">3 <span class="center-dot"></span> Vim Within Emacs: An Anecdotal Guide</a>
            <div class="small-detail">After using Emacs for 2 years, I decided to give &quot;evil-mode&quot; (Vim keybindings) a tentative try and I&#x27;m not looking back.</div></li>
        
          <li class="selected"><a class="small-title" href="/2017/3/complete-guide-email-emacs-using-mu-and-/">4 <span class="center-dot"></span> A Complete Guide to Email in Emacs using Mu and Mu4e</a>
            <div class="small-detail">Most email clients are a pain. Emacs &amp; mu4e are less of a pain.</div></li>
        
          <li ><a class="small-title" href="/2018/6/org-literate-programming/">5 <span class="center-dot"></span> Literate Programming with Org-mode</a>
            <div class="small-detail">I frequently use Org mode to combine code snippets and analysis in a single document, a programming paradigm known as Literate Programming. Here are a few example showing how powerful this setup can be.</div></li>
        
          <li ><a class="small-title" href="/2020/3/org-mode-annotated-bibliography/">6 <span class="center-dot"></span> Managing my Annotated Bibliography with Emacs&#x27; Org Mode</a>
            <div class="small-detail">Org mode is a fantastic tool for managing references. Here&#x27;s a description of how I use it, and some additional packages, to manage my annotated bibliography.</div></li>
        
      </ul>
    </div>
    <hr/>
  

  <div>
  <div class="social-icon-container visible-xs">
    <a class="social-icon twitter"
         href="https://twitter.com/intent/tweet?url=http%3A%2F%2Fcachestocaches.com%2F2017%2F3%2Fcomplete-guide-email-emacs-using-mu-and-%2F&text=Great%20post%20at"></a><a class="social-icon facebook"
         href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fcachestocaches.com%2F2017%2F3%2Fcomplete-guide-email-emacs-using-mu-and-%2F"></a><a class="social-icon googleplus"
         href="https://plus.google.com/share?url=http%3A%2F%2Fcachestocaches.com%2F2017%2F3%2Fcomplete-guide-email-emacs-using-mu-and-%2F"></a><a class="social-icon linkedin"
         href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fcachestocaches.com%2F2017%2F3%2Fcomplete-guide-email-emacs-using-mu-and-%2F&title=Caches%20To%20Caches&source=http%3A//cachestocaches.com"></a><a class="social-icon rss-feed"
         href="/feed"></a>
  </div>
</div>


  <hr/>

  <script type="text/javascript">
/* * * CONFIGURATION VARIABLES * * */
var disqus_shortname = 'cachestocaches';

/* * * DON'T EDIT BELOW THIS LINE * * */
 function createCallback() {
     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
     dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
   };
</script>
<a class="heading-font" id="disqus_thread" style="cursor:pointer;"onclick="createCallback();return false;"><h4 class="constrain-width">+ Show Comments From Disqus</h4></a>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

  

      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <div class="content">
      
  <div><a href="/"><img src="/static/logos/c2c_logo_2.png" class="img-responsive center-block" style="width:240px;"/></a></div>
  <br/>
  <div class="center-text narrow-font">
    <span><a href="/">home</a></span>
    <span class="center-dot"></span>
    <span><a href="/archive/">archive</a></span>
    <span class="center-dot"></span>
    <span><a href="/contributors/">about</a></span>
  </div>
  <div class="social-icon-container">
    <a class="social-icon light-border twitter" href="https://twitter.com/intent/follow?screen_name=CachesToCaches"></a>
    <a class="social-icon light-border facebook" href="https://www.facebook.com/CachesToCaches"></a>
    <a class="social-icon light-border googleplus" href="https://www.google.com/+Cachestocaches_c2c" rel="publisher"></a>
    <a class="social-icon light-border github" href="https://github.com/CachesToCaches"></a>
    <a class="social-icon light-border rss-feed" href="/feed"></a>
  </div>

  <br/>
  <div class="center-text"><a href="http://gjstein.com">designed and maintained by<br/>Gregory J Stein</a></div>

      
      
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

    <!-- Sidebar / Table of Contents -->
    <script src="/static/styles/js/jquery.tableofcontents.g.min.js"></script>
    <script src="/static/styles/js/sticky-nav.js"></script>
    <script src="/static/styles/js/bootstrap-scrollspy.min.js"></script>
    <script>
    $(function(){$("#toc").tableOfContents(null,{
      startLevel: 2, depth: 1});
      $('body').scrollspy({
        target: '#nav-sidebar',
        offset: 20});
    });
    </script>
    
    <!-- Code Highlighting : highlight.js -->
    

<!-- <link rel="stylesheet" href="/static/highlight/styles/c2c.css"> -->
<script src="/static/highlight/highlight.pack.js"></script>
<script>hljs.configure({languages:[]});hljs.initHighlightingOnLoad();</script>
<script src="/static/styles/js/anchor-scroll.js"></script>


    <!-- Equation Rendering : mathjax -->
    <script type="text/x-mathjax-config">
     MathJax.Hub.Config({
       jax: ["input/TeX","output/CommonHTML"],
       tex2jax: { inlineMath: [["$","$"]] },
       CommonHTML: {
         linebreaks: { automatic: true, width: "container" }
       }
     });
    </script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML" type="text/javascript"></script>

    
  <script>
  (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
          function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
          e=o.createElement(i);r=o.getElementsByTagName(i)[0];
          e.src='//www.google-analytics.com/analytics.js';
          r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
  ga('create','UA-60578350-2','auto');ga('send','pageview');
  </script>

  </body>
</html>
