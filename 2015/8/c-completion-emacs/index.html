<!doctype html>
<html class="no-js" lang="">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>C/C++ Completion in Emacs</title>
    <meta name="description" content="Handle large-project C++ completion with Irony &amp; GNU GLOBAL">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    

<link rel="apple-touch-icon" sizes="57x57" href="/static/c2c_icons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/static/c2c_icons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/static/c2c_icons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/static/c2c_icons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/static/c2c_icons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/static/c2c_icons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/static/c2c_icons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/static/c2c_icons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/static/c2c_icons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="/static/c2c_icons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/static/c2c_icons/favicon-194x194.png" sizes="194x194">
<link rel="icon" type="image/png" href="/static/c2c_icons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/static/c2c_icons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/static/c2c_icons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/static/c2c_icons/manifest.json">
<link rel="mask-icon" href="/static/c2c_icons/safari-pinned-tab.svg" color="#773333">
<link rel="shortcut icon" href="/static/c2c_icons/favicon.ico">
<meta name="msapplication-TileColor" content="#773333">
<meta name="msapplication-TileImage" content="/static/c2c_icons/mstile-144x144.png">
<meta name="msapplication-config" content="/static/c2c_icons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

    <!-- 3rd March 2022 07:41 -->
    <!-- Fonts -->    
    <link href='https://fonts.googleapis.com/css?family=Unica+One' rel='stylesheet' type='text/css'>
    <script src="https://use.typekit.net/qeu2zlf.js"></script>
    <script>try{Typekit.load({ async: false });}catch(e){}</script>
    <noscript>
      <!-- Fallback fonts (if no JS) -->
      <link href='http://fonts.googleapis.com/css?family=Dosis:400|Anonymous+Pro' rel='stylesheet' type='text/css'>
    </noscript>

    <!-- Styles / Scripts -->
    
    <link rel="stylesheet" href="/static/styles/css/cachestocaches.min.css"/>
    <script src="/static/styles/js/modernizr-2.8.3.min.js"></script>

    

  
  
  
  <meta name="twitter:card"
          content="summary_large_image" />
  <meta prefix="og: http://ogp.me/ns#"
          name="twitter:title"
          property="og:title"
          content="C/C++ Completion in Emacs" />
  <meta name="twitter:site"
          content="@CachesToCaches">
  <meta prefix="og: http://ogp.me/ns#"
          property="og:type"
          content="website" />
  
  
    <meta prefix="og: http://ogp.me/ns#"
            name="twitter:image:src"
            property="og:image"
            content="http://cachestocaches.com/media/photologue/photos/cache/code_completion_emacs_cover_display.png" />
    <meta name="thumbnail"
            content="http://cachestocaches.com/media/photologue/photos/cache/code_completion_emacs_cover_thumbnail.png" />
  
  
  <meta prefix="og: http://ogp.me/ns#"
          name="twitter:description"
          property="og:description"
          content="Handle large-project C++ completion with Irony &amp; GNU GLOBAL" />
  <meta prefix="og: http://ogp.me/ns#"
          property="og:url"
          content="http://cachestocaches.com/2015/8/c-completion-emacs/" />

  </head>

  <body
      itemscope
      itemtype="http://schema.org/WebPage"
      data-spy="scroll"
      data-target="#side-nav">
    
    <nav class="sidebar">
      <div class="content">
        
  <div><a href="/"><img src="/static/logos/c2c_logo_2.png" class="img-responsive center-block" style="width:240px;"/></a></div>
  <br/>
  <div class="center-text narrow-font">
    <span><a href="/">home</a></span>
    <span class="center-dot"></span>
    <span><a href="/archive/">archive</a></span>
    <span class="center-dot"></span>
    <span><a href="/contributors/">about</a></span>
  </div>
  <div class="social-icon-container">
    <a class="social-icon light-border twitter" href="https://twitter.com/intent/follow?screen_name=CachesToCaches"></a>
    <a class="social-icon light-border facebook" href="https://www.facebook.com/CachesToCaches"></a>
    <a class="social-icon light-border googleplus" href="https://www.google.com/+Cachestocaches_c2c" rel="publisher"></a>
    <a class="social-icon light-border github" href="https://github.com/CachesToCaches"></a>
    <a class="social-icon light-border rss-feed" href="/feed"></a>
  </div>

  <img class="bottom-art" src="/static/art/c2c_triangles.svg"></img>
  <div class="center-text floating-description"><a href="http://gjstein.com">designed and maintained by<br/>Gregory J Stein</a></div>

        <br/>
        
  <div class="title"><a href="#">C/C++ Completion in Emacs</a></div>
  <hr/>
  <div id="nav-sidebar">
    <ul class="nav" id="toc"></ul>
  </div>
  <hr/>
  

      </div>
    </nav>
    <nav class="header">
      
  <div class="content">
  <span class="heading-font"><a href="/">Caches to Caches</a> | </span><span><a href="/">home</a></span><span class="center-dot"></span><span><a href="/archive/">archive</a></span><span class="center-dot"></span><span><a href="/contributors/">about</a></span>
  </div>

    </nav>
    <div class="page"
         itemsope
         itemtype="http://schema.org/Blog">
      <div class="content-top">
        
  <div class="unit-line-height">
  
  <!-- Series Details -->

  <!-- Post Image -->
    <div class="marginnote invisible-sm post-detail">
      <div>
      

        <p><div class="date heading-font">Wed 5 Aug 2015</div>
          <a href="/contributors/#gregory-j-stein"><span class="author" itemprop="name">Gregory J Stein</span></a>
          
        </p>

        
          <p><div class="heading-font">Category</div>
            <a class="category" href="/category/general-computing/">
              General Computing
            </a>
          </p>
        

        
          <p><div class="heading-font">Tags</div>
            
              <a class="tag" href="/tag/emacs/">Emacs</a>
            
              <a class="tag" href="/tag/cc/">C/C++</a>
            
          </p>
        
      </div>
    </div>

    
      <h1 class="title">
        <div>
          <span itemprop="name">C/C++ Completion in Emacs</span>
        </div>
      </h1>
    

    


    <div class="note visible-sm post-detail">
      <div>

      <div>
        <span class="date heading-font">Wed 5 Aug 2015</span>
          <a href="/contributors/#gregory-j-stein"><span class="author" itemprop="name">Gregory J Stein</span></a>
          
      </div>

        
          <div>
          <span class="heading-font">Category</span>
            <a class="category" href="/category/general-computing/">
              General Computing
            </a>
          </div>
        

        
          <div><span class="heading-font">Tags</span>
            
              <a class="tag" href="/tag/emacs/">Emacs</a>
            
              <a class="tag" href="/tag/cc/">C/C++</a>
            
          </div>
        


        
      </div>
    </div>


</div>


      </div>
      <div class="content">
        
  
  <div class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">

  <!-- Post Title -->
  
  

  <!-- Post Content -->
  
    <div class="justify word-break" itemprop="articleBody">
      
        <p>I do a lot of work using <code>C/C++</code> for my research. As projects grow in size and the number of contributors increases, it becomes increasingly difficult to keep track of even the most commonly used classes and their parameters and methods. I rely on emacs to do most of my code editing, so ensuring that I have a code-completion setup within it is essential. I rely on <a href="http://company-mode.github.io">company-mode</a>, short for 'complete anything' for completion using additional software behind the scenes. Company is a fantastic and rather popular framework for completion within emacs. Users can create functions, known as 'company-backends', which each return a list of completion matches. </p>
<p>For my needs, I've become fond of using both <a href="https://github.com/Sarcasm/irony-mode">irony</a>, which relies on <code>libclang</code>, and <a href="http://www.gnu.org/software/global/">gtags</a>, which is a part of GNU GLOBAL. Irony is the smarter engine, capable of completing variables defined within the function and, to some extent, classes in included header files. By contrast, gtags searches the entire project directory, resulting in a cruder yet more comprehensive search. Between the two of these, I haven't needed any others.</p>
<p>Continue reading for more.</p>
<p></p>
<h2>Emacs Configuration</h2>
<p>Getting emacs to work with these backends involves installing a few packages: <a href="https://github.com/company-mode/company-mode">company</a>, <a href="https://github.com/Sarcasm/irony-mode">irony</a>, and <a href="https://github.com/Sarcasm/company-irony">company-irony</a>. All of these are available through the package manager and 'melpa', and, in the configuration file I've provided at the <a href="https://github.com/CachesToCaches/emacs_cpp_completion">github repo for this post</a>, I rely on <code>use-package</code> to install them automatically. If you've never heard of <a href="https://github.com/jwiegley/use-package">use-package</a> (which I have a <a href="http://cachestocaches.com/2015/8/getting-started-use-package/">separate post about</a>), I highly recommend that you check it out. The configuration file in the repo includes code for installing/activating <code>use-package</code> if you have not already done so</p>
<p>The bulk of the source code I use/provide for configuring these packages is shown here:</p>
<p><div class="listing-caption visible-sm">Emacs Lisp for Code Completion <code class="code-language">Lisp</code></div><div class="sidenote listing-caption invisible-sm"><div>Emacs Lisp for Code Completion</div><div class="unit-line-height"><code class="code-language">Lisp</code></div></div><pre><code class="lang-lisp pre-scrollable">;; == irony-mode ==
(use-package irony
  :ensure t
  :defer t
  :init
  (add-hook 'c++-mode-hook 'irony-mode)
  (add-hook 'c-mode-hook 'irony-mode)
  (add-hook 'objc-mode-hook 'irony-mode)
  :config
  ;; replace the `completion-at-point' and `complete-symbol' bindings in
  ;; irony-mode's buffers by irony-mode's function
  (defun my-irony-mode-hook ()
    (define-key irony-mode-map [remap completion-at-point]
      'irony-completion-at-point-async)
    (define-key irony-mode-map [remap complete-symbol]
      'irony-completion-at-point-async))
  (add-hook 'irony-mode-hook 'my-irony-mode-hook)
  (add-hook 'irony-mode-hook 'irony-cdb-autosetup-compile-options)
  )

;; == company-mode ==
(use-package company
  :ensure t
  :defer t
  :init (add-hook 'after-init-hook 'global-company-mode)
  :config
  (use-package company-irony :ensure t :defer t)
  (setq company-idle-delay              nil
	company-minimum-prefix-length   2
	company-show-numbers            t
	company-tooltip-limit           20
	company-dabbrev-downcase        nil
	company-backends                '((company-irony company-gtags))
	)
  :bind ("C-;" . company-complete-common)
  )

</code></pre></p>
<h2>Configuring the Completion Engines</h2>
<p>Despite the power of emacs, the completion backends installed here leverage the power of additional tools which must be configured on their own, namely <code>clang</code> and <code>GNU GLOBAL</code>. This section shows how to install these tools and how to set them up for use alongside emacs. [Ubuntu is currently the only procedure listed here, but I've gotten OS X working, and I will include it as well in the future.]</p>
<h3>Ubuntu 14.04 Installation</h3>
<p>On Ubuntu, the installation of the required packages is extremely simple, since it relies on the apt package manager. Simply run the following:</p>
<p><pre class="pre-scrollable"><code class="lang-bash">$ sudo apt-get install libclang-3.5-dev
$ sudo apt-get install global
</code></pre></p>
<p>Note that <code>libclang-3.5-dev</code>, the requirement for Irony, is the latest version as of this writing, but feel free to use a later version if one exists. Finally, gtags is included in the install of <code>global</code>.</p>
<h3>Activating Irony and GNU Global</h3>
<p>Once installed, the different packages must be properly set-up (outside of emacs) in order to get them to work properly, though this process is extremely simple for both.</p>
<p>For Irony, activation requires simply calling a command from emacs, namely:</p>
<p><pre class="pre-scrollable"><code>M-x irony-install-server
</code></pre></p>
<p>In which file this code is run does not matter. The command creates an <code>irony</code> folder in your <code>~/.emacs.d</code> directory, and the resulting irony server is shared across emacs. However, Irony is quite intelligent, and can determine what classes have been imported into the file of interest.</p>
<p>For GTAGS, one must use the command line. Simply move to the parent directory of your project using <code>cd</code> and then run the <code>gtags</code> command. This will parse all of the source files in the directory and create a list of "tags" which are then used for code completion. It should be noted that, I cannot seem to figure out if GTAGS updates as files are saved. Though Irony will asynchronously re-parse files it has already searched, you may periodically need to rerun the <code>gtags</code> command on the directory as files are substantially changed. However, this should not be an overwhelming inconvenience for large projects, for which large portions of the code remain static for extended periods of time.</p>
<h2>An Example</h2>
<p>I've included some (very basic) example code at the <a href="https://github.com/CachesToCaches/emacs_cpp_completion">github repo associated with this post</a>. In it, besides the emacs lisp configuration file shown above, are a few <code>C++</code> files which can be used to test the code. Clone this repo and then use <code>C-x C-f</code> to enter the included <code>main.cpp</code> file. The contents of the file include a few simple variable definitions. In addition, the GTAGS files are not included, so you will have to run <code>gtags</code> on the directory.</p>
<p>The first set of variables defined are <code>foobar</code> and <code>foobar_d</code>. To call completion, type <code>foo</code> on a new line and, with your cursor placed directly after, run <code>company-complete-common</code> using the <code>C-;</code> keybinding and you should be presented with a drop-down menu as follows:</p>
<p><img src="/media/photologue/photos/cache/irony_local_completion_display.png" class="img-responsive center-block" title="Irony Local Completion" style="max-height:107px"/></p>
<p>Selecting the option you'd like can be done in a number of ways:</p>
<ul>
<li>Pressing <code>tab</code> will complete using the highlighted option, which can be scrolled through using <code>M-n</code> and <code>M-p</code>. </li>
<li>Pressing <code>M-#</code>, where # is the number to the right of a particular option, will select/complete that option. </li>
<li><code>C-s</code> can be run while the company mode dropdown is open and additional text can be typed to narrow the search.</li>
</ul>
<p>In addition, the completion engines can be used to complete the class members of an object. In this case, I've defined <code>square</code>, an instance of the included <code>rect</code> class. It has two integer properties, <code>height</code> and <code>width</code> and a function <code>area()</code>. Run <code>company-complete-common</code> after typing <code>square.</code> (note the period) and the following should appear:</p>
<p><img src="/media/photologue/photos/cache/object_completion_display.png" class="img-responsive center-block" title="Irony Object Completion" style="max-height:153px"/></p>
<p>Notice that some of the options appear multiple times. This is because both completion engines are capable of finding some of the same candidates. This simple example should be enough to get you started with your own projects.</p>
<h2>Further Reading</h2>
<p>If you wish to configure these packages further, I recommend that you take a look at the github repositories for each:</p>
<ul>
<li><a href="https://github.com/company-mode/company-mode">company</a></li>
<li><a href="https://github.com/Sarcasm/irony-mode">irony</a></li>
<li><a href="https://github.com/Sarcasm/company-irony">company-irony</a></li>
</ul>
<p>Finally, this tutorial was inspired by this incredible post/tutorial: <a href="http://tuhdo.github.io/c-ide.html">Setup C/C++ Development Environment for Emacs</a>. If you're seriously looking at using emacs for C/C++, you can pick up a lot of tricks by looking through it.</p>
      
    </div>
  

  <!-- Post Footer -->
  

  <!-- Additional Metadata -->
  <meta itemprop="description" content="Handle large-project C++ completion with Irony &amp; GNU GLOBAL">

</div>


      </div>
      <div class="content-bottom">
        

  <hr/>
  <p><blockquote>
    Liked this post? Subscribe to our <a class="post-link" href="/feed">RSS feed</a> or add your email to our newsletter:

    <!-- Begin MailChimp Signup Form -->
    <link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
    <div id="mc_embed_signup">
      <form action="https://cachestocaches.us15.list-manage.com/subscribe/post?u=f290745e370ad37f53ed7c7ac&amp;id=b7922d14de" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
        <div id="mc_embed_signup_scroll">
	  
	  <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
          <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
          <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_f290745e370ad37f53ed7c7ac_b7922d14de" tabindex="-1" value=""></div>
          <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
        </div>
      </form>
    </div>

  </blockquote></p>

  <!--End mc_embed_signup-->
  <hr/>


  <!-- All posts in series -->
  

  <div>
  <div class="social-icon-container visible-xs">
    <a class="social-icon twitter"
         href="https://twitter.com/intent/tweet?url=http%3A%2F%2Fcachestocaches.com%2F2015%2F8%2Fc-completion-emacs%2F&text=Great%20post%20at"></a><a class="social-icon facebook"
         href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fcachestocaches.com%2F2015%2F8%2Fc-completion-emacs%2F"></a><a class="social-icon googleplus"
         href="https://plus.google.com/share?url=http%3A%2F%2Fcachestocaches.com%2F2015%2F8%2Fc-completion-emacs%2F"></a><a class="social-icon linkedin"
         href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fcachestocaches.com%2F2015%2F8%2Fc-completion-emacs%2F&title=Caches%20To%20Caches&source=http%3A//cachestocaches.com"></a><a class="social-icon github"
           href="https://github.com/CachesToCaches/emacs_cpp_completion"></a><a class="social-icon rss-feed"
         href="/feed"></a>
  </div>
</div>


  <hr/>

  <script type="text/javascript">
/* * * CONFIGURATION VARIABLES * * */
var disqus_shortname = 'cachestocaches';

/* * * DON'T EDIT BELOW THIS LINE * * */
 function createCallback() {
     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
     dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
   };
</script>
<a class="heading-font" id="disqus_thread" style="cursor:pointer;"onclick="createCallback();return false;"><h4 class="constrain-width">+ Show Comments From Disqus</h4></a>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

  

      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <div class="content">
      
  <div><a href="/"><img src="/static/logos/c2c_logo_2.png" class="img-responsive center-block" style="width:240px;"/></a></div>
  <br/>
  <div class="center-text narrow-font">
    <span><a href="/">home</a></span>
    <span class="center-dot"></span>
    <span><a href="/archive/">archive</a></span>
    <span class="center-dot"></span>
    <span><a href="/contributors/">about</a></span>
  </div>
  <div class="social-icon-container">
    <a class="social-icon light-border twitter" href="https://twitter.com/intent/follow?screen_name=CachesToCaches"></a>
    <a class="social-icon light-border facebook" href="https://www.facebook.com/CachesToCaches"></a>
    <a class="social-icon light-border googleplus" href="https://www.google.com/+Cachestocaches_c2c" rel="publisher"></a>
    <a class="social-icon light-border github" href="https://github.com/CachesToCaches"></a>
    <a class="social-icon light-border rss-feed" href="/feed"></a>
  </div>

  <br/>
  <div class="center-text"><a href="http://gjstein.com">designed and maintained by<br/>Gregory J Stein</a></div>

      
      
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

    <!-- Sidebar / Table of Contents -->
    <script src="/static/styles/js/jquery.tableofcontents.g.min.js"></script>
    <script src="/static/styles/js/sticky-nav.js"></script>
    <script src="/static/styles/js/bootstrap-scrollspy.min.js"></script>
    <script>
    $(function(){$("#toc").tableOfContents(null,{
      startLevel: 2, depth: 1});
      $('body').scrollspy({
        target: '#nav-sidebar',
        offset: 20});
    });
    </script>
    
    <!-- Code Highlighting : highlight.js -->
    

<!-- <link rel="stylesheet" href="/static/highlight/styles/c2c.css"> -->
<script src="/static/highlight/highlight.pack.js"></script>
<script>hljs.configure({languages:[]});hljs.initHighlightingOnLoad();</script>
<script src="/static/styles/js/anchor-scroll.js"></script>


    <!-- Equation Rendering : mathjax -->
    <script type="text/x-mathjax-config">
     MathJax.Hub.Config({
       jax: ["input/TeX","output/CommonHTML"],
       tex2jax: { inlineMath: [["$","$"]] },
       CommonHTML: {
         linebreaks: { automatic: true, width: "container" }
       }
     });
    </script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML" type="text/javascript"></script>

    
  <script>
  (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
          function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
          e=o.createElement(i);r=o.getElementsByTagName(i)[0];
          e.src='//www.google-analytics.com/analytics.js';
          r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
  ga('create','UA-60578350-2','auto');ga('send','pageview');
  </script>

  </body>
</html>
